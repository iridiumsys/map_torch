<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Exploration Map</title>
    <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Turf.js/6.5.0/turf.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        #map {
            width: 100%;
            height: 90vh;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 4px;
            font-size: 14px;
            max-width: 300px;
        }
        #info.hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div id="info" class="hidden">Cliquez sur un point pour découvrir une narration ou collecter un objet.</div>
    <div id="map"></div>

    <script>
        const map = new maplibregl.Map({
            container: 'map',
            style: 'https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json', // Carto style basemap
            center: [0, 0], // Initial coordinates
            zoom: 2
        });

        const hiddenZones = [
            { id: 1, coordinates: [10, 10], description: "Une ancienne ruine mystique, cachée depuis des siècles." },
            { id: 2, coordinates: [-20, 15], description: "Un trésor perdu dans le désert, enterré par des pirates." }
        ];

        const collectedItems = [];

        // Ajouter les zones mystères à la carte
        map.on('load', () => {
            hiddenZones.forEach(zone => {
                const circle = turf.circle(zone.coordinates, 50, { steps: 64, units: 'kilometers' });

                map.addSource(`zone-${zone.id}`, {
                    type: 'geojson',
                    data: circle
                });

                map.addLayer({
                    id: `zone-layer-${zone.id}`,
                    type: 'fill',
                    source: `zone-${zone.id}`,
                    paint: {
                        'fill-color': '#FFD700',
                        'fill-opacity': 0.5
                    }
                });
            });
        });

        // Afficher la narration lorsqu'un utilisateur clique sur une zone
        map.on('click', (e) => {
            const features = map.queryRenderedFeatures(e.point, {
                layers: hiddenZones.map(zone => `zone-layer-${zone.id}`)
            });

            if (features.length > 0) {
                const clickedZone = hiddenZones.find(zone => `zone-layer-${zone.id}` === features[0].layer.id);

                if (!collectedItems.includes(clickedZone.id)) {
                    collectedItems.push(clickedZone.id);
                    alert(`Découverte : ${clickedZone.description}`);
                } else {
                    alert("Vous avez déjà découvert cette zone.");
                }
            }
        });

        // Masquer le guide après 10 secondes
        setTimeout(() => {
            document.getElementById('info').classList.add('hidden');
        }, 10000);
    </script>
</body>
</html>
